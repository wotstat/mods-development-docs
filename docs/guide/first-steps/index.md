# Введение

Разработка модификаций подразумевает изменение каких-либо аспектов игры, будь то графика, интерфейс или игровой процесс.

Игра состоит из клиентской и серверной части. Просчёт всей игровой логики происходит на сервере и недоступен для какого либо изменения со стороны клиента. Любые пользовательские модификации могут влиять исключительно на клиентскую часть игры.

:::warning Запрещенные модификации
Перед разработкой модификаций, убедитесь, что вы ознакомились со [списком запрещённых модификаций](https://tanki.su/ru/content/guide/ban/nonusefulmods)

Основная философия запрета заключается в том, что модификации не должны давать игроку преимущества в бою, которое не может быть получено без них.
:::

## Компоненты игры
Игра Мир Танков состоит из следующих основных компонентов:
- **Движок игры** Core (`BigWorld`) –  написан на C++. Отвечает за сетевое взаимодействие и графический пайплайн.
- **Игровые скрипты** – написаны на `Python 2.7`. Отвечают за логику игры и взаимодействие с пользователем.
- **Пользовательский интерфейс**
  - Старые окна интерфейса – написаны на `Scaleform` (ActionScript 3.0 Flash). Весь боевой интерфейс и часть анара.
  - Новый интерфейс – написан на `Coherent Gameface` (JavaScript, CSS, HTML).
  - Полные браузерные окна – в игре присутствуют окна, которые реализованы с помощью встроенного браузера и представляют веб-сайты (например сборочный цех).
- **Ресурсы игры** – модели, текстуры, звуки и прочее – хранятся в виде файлов в `pkg` архивах на диске и могут быть легко заменены.

| Ресурс           | Язык             | Возможность модифицировать |
| ---------------- | ---------------- | -------------------------- |
| Движок игры      | C++              | Почти невозможно           |
| Игровые скрипты  | Python 2.7       | Легко                      |
| Старый интерфейс | ActionScript 3.0 | С ограничениями            |
| Новый интерфейс  | JavaScript       | Тяжело                     |
| Браузерные окна  | -                | Невозможно                 |
| Ресурсы игры     | -                | Легко                      |


## Виртуальная файловая система

Игра использует виртуальную файловую систему (`VFS` ), которая позволяет загружать ресурсы из нескольких источников и объединять их в единое целое.

Официальные ресурсы игры хранятся в `pkg` архивах в папке `/res/packages` внутри папки с игрой. Архивы `.pkg` являются обычными `zip` архивами и могут быть открыты с помощью любого архиватора, например [`7-Zip`](https://www.7-zip.org).

По мере надобности, игра загружает ресурсы из этих архивов в общую виртуальную файловую систему.

> Например при запуске режима Натиск игра загружает `comp7.pkg`, который содержит все ресурсы, скрипты и интерфейсные элементы, необходимые для этого режима.

### Загрузка пользовательских модификаций

Игра предусматривает автоматическую загрузку пользовательских модификаций в VFS из следующих папок:
- `/res_mods/<версия_игры>/` – загружает `.py` и `.pyc` скрипты, используется во время разработки модов. **`TODO: фактчек`**
- `/mods/<версия_игры>/*.mtmod` – загружает только `.pyc` скрипты, используется для распространения готовых модов.


### Формат `.mtmod`

Формат `.mtmod` используется для распространения готовых модификаций. Файл `.mtmod` является обычным `zip` архивом с **нулевым сжатием** и содержит в себе структуру папок, которая будет воспроизведена в виртуальной файловой системе игры на этапе её загрузки.

Приятно использовать следующую структуру названия пакетов модов:
```
<автор>.<название_мода>_<версия_мода>.mtmod
```

> Например: `wotstat.analytics_1.0.0.mtmod`, `me.poliroid.gunmark_2.1.3.mtmod`

#### `meta.xml`
Внутри архива `.mtmod` рекомендуется размещать `meta.xml` файл, который содержит описание мода в следующем формате:
```xml
<root>
  <id>Уникальное название мода</id>
  <version>Версия мода</version>
  <name>Отображаемое имя мода</name>
  <description>Описание мода</description>
  <changelog>Что нового</changelog>
</root>
```

::: details Пример `meta.xml`
```xml
<root>
  <id>panikaxa.quick_demount</id>
  <version>2.1.0</version>
  <name>Quick demount</name>
  <description>Мод предоставляет возможность при нажатии правой кнопки мыши на слоте оборудования выбрать из контекстного меню танк, на котором установлено данное оборудование и автоматически демонтировать его с выбранного танка.</description>
  <changelog>Добавлена возможность докупить оборудование из контекстного меню.</changelog>
</root>
```
:::

### Точка входа модов

Точка входа – это место, откуда начинается выполнение кода модификации. Игра автоматически запускает скрипты, которые начинаются с префикса `mod_` из папки `res/scripts/client/gui/mods` виртуальной файловой системы.

В таком файле может быть определена функция `init()`, которая будет вызвана автоматически при загрузке игры и `fini()` для завершения работы мода.

::: details Пример файловой системы мода и `mod_` файла
```python
.mtmod
├── meta.xml
└── res/
    └── scripts/
        └── client/
            └── gui/
                └── mods/
                    ├── mod_demo.pyc  # [!code highlight]
                    ├── utils.pyc
                    └── features/
                        ├── feature1.pyc
                        └── feature2.pyc
```

mod_demo.py:
```python
import BigWorld

def init():
  print("Demo mod initialized")

def fini():
  print("Demo mod finalized")
```
:::
